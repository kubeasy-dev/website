{"$schema":"https://json-schema.org/draft/2020-12/schema","title":"Kubeasy Validation","description":"Schema for Kubeasy challenge validations","type":"object","properties":{"key":{"type":"string","description":"Unique identifier (kebab-case, e.g., \"deployment-ready\")"},"title":{"type":"string","description":"Human-readable name displayed to users"},"description":{"type":"string","description":"Explains what this validation checks"},"order":{"type":"integer","description":"Display sequence (lower numbers first)"},"type":{"type":"string","enum":["status","log","event","metrics","connectivity"],"description":"• status: TypeStatus validates Kubernetes resource conditions (Ready, Available, Progressing) Value: \"status\" - Use when checking if Deployments, Pods, StatefulSets are in expected state\n• log: TypeLog searches container logs for expected strings Value: \"log\" - Use when verifying application behavior, startup messages, or processed requests\n• event: TypeEvent validates that forbidden Kubernetes events are NOT present Value: \"event\" - Use when ensuring pods aren't crash-looping, OOMKilled, or failing to schedule\n• metrics: TypeMetrics validates numeric fields from resource status Value: \"metrics\" - Use when checking replica counts, restart counts, or other numeric conditions\n• connectivity: TypeConnectivity tests HTTP connectivity between pods Value: \"connectivity\" - Use when verifying Services, NetworkPolicies, or inter-pod communication"},"spec":{"description":"Type-specific configuration (depends on \"type\" field)","oneOf":[{"$ref":"#/$defs/StatusSpec"},{"$ref":"#/$defs/LogSpec"},{"$ref":"#/$defs/EventSpec"},{"$ref":"#/$defs/MetricsSpec"},{"$ref":"#/$defs/ConnectivitySpec"}]}},"required":["key","title","description","order","type","spec"],"$defs":{"ValidationType":{"type":"string","enum":["status","log","event","metrics","connectivity"],"description":"ValidationType represents the type of validation to execute Each type has a corresponding spec structure and executor"},"Target":{"type":"object","properties":{"kind":{"type":"string","description":"Kind is the Kubernetes resource type to target Common values: Deployment, Pod, Service, StatefulSet, Job, ConfigMap, Secret, DaemonSet"},"name":{"type":"string","description":"Name matches a specific resource by exact name If both Name and LabelSelector are provided, Name takes precedence"},"labelSelector":{"type":"object","additionalProperties":{"type":"string"},"description":"LabelSelector matches resources by labels, e.g., {\"app\": \"nginx\", \"tier\": \"frontend\"} For single-resource validations, the first matching resource is used"}},"description":"Target identifies a Kubernetes resource to validate Use either Name for exact match or LabelSelector for multiple resources","required":["kind"],"additionalProperties":false},"StatusSpec":{"type":"object","properties":{"target":{"$ref":"#/$defs/Target","description":"Target specifies which Kubernetes resource to check"},"conditions":{"type":"array","items":{"$ref":"#/$defs/StatusCondition"},"description":"Conditions lists the status conditions that must ALL be met Deployment conditions: Available, Progressing, ReplicaFailure Pod conditions: Ready, ContainersReady, Initialized, PodScheduled"}},"description":"StatusSpec validates Kubernetes resource conditions (Ready, Available, etc.) Use when: checking if a Deployment/Pod/StatefulSet is in the expected state","required":["target","conditions"],"additionalProperties":false},"StatusCondition":{"type":"object","properties":{"type":{"type":"string","description":"Type is the condition type to check Deployment: \"Available\", \"Progressing\", \"ReplicaFailure\" Pod: \"Ready\", \"ContainersReady\", \"Initialized\", \"PodScheduled\""},"status":{"type":"string","description":"Status is the expected condition status Values: \"True\", \"False\", \"Unknown\""}},"description":"StatusCondition represents a single condition to verify on a resource Maps to Kubernetes status.conditions[] entries","required":["type","status"],"additionalProperties":false},"LogSpec":{"type":"object","properties":{"target":{"$ref":"#/$defs/Target","description":"Target specifies which Pod(s) to check logs from"},"container":{"type":"string","description":"Container specifies which container's logs to check (optional if pod has single container) Required for multi-container pods, e.g., \"nginx\", \"sidecar\", \"init-container\""},"expectedStrings":{"type":"array","items":{"type":"string"},"description":"ExpectedStrings lists strings that must ALL appear in the logs Tips: use unique strings, avoid timestamps, consider log format Examples: \"Server started\", \"Connected to database\", \"HTTP/1.1 200\""},"sinceSeconds":{"type":"integer","description":"SinceSeconds limits log search to recent entries (optional) Useful for avoiding false positives from old logs, e.g., 300 for last 5 minutes"}},"description":"LogSpec searches container logs for expected strings Use when: verifying application behavior, startup completion, or processed requests","required":["target","expectedStrings"],"additionalProperties":false},"EventSpec":{"type":"object","properties":{"target":{"$ref":"#/$defs/Target","description":"Target specifies which resource's events to check"},"forbiddenReasons":{"type":"array","items":{"type":"string"},"description":"ForbiddenReasons lists event reasons that should NOT be present Common values: CrashLoopBackOff, ImagePullBackOff, OOMKilled, Error, BackOff, FailedScheduling, FailedMount, Unhealthy, Evicted, NodeNotReady"},"sinceSeconds":{"type":"integer","description":"SinceSeconds limits the time window for event checking (optional) Events older than this are ignored, e.g., 600 for last 10 minutes When omitted (0), checks all events regardless of age"}},"description":"EventSpec checks for absence of problematic Kubernetes events Use when: ensuring pods aren't crash-looping or failing to pull images","required":["target","forbiddenReasons"],"additionalProperties":false},"MetricsSpec":{"type":"object","properties":{"target":{"$ref":"#/$defs/Target","description":"Target specifies which Kubernetes resource to check"},"checks":{"type":"array","items":{"$ref":"#/$defs/MetricCheck"},"description":"Checks lists all numeric field validations that must pass"}},"description":"MetricsSpec validates numeric fields from resource status Use when: checking replica counts, restart counts, or resource quantities","required":["target","checks"],"additionalProperties":false},"MetricCheck":{"type":"object","properties":{"field":{"type":"string","description":"Field is the dot-notation path to the numeric field in the resource Common paths: status.readyReplicas, status.availableReplicas, status.replicas, spec.replicas. Array indexing uses dot notation: status.containerStatuses.0.restartCount"},"operator":{"type":"string","description":"Operator is the comparison operator to use Supported: \"==\" (equal), \"!=\" (not equal), \">\" (greater than), \"<\" (less than), \">=\" (greater or equal), \"<=\" (less or equal) Example: operator: \">=\" with value: 3 checks if field is at least 3"},"value":{"type":"integer","description":"Value is the expected numeric value to compare against"}},"description":"MetricCheck represents a single numeric field validation Compares a resource field value against an expected value using an operator","required":["field","operator","value"],"additionalProperties":false},"ConnectivitySpec":{"type":"object","properties":{"sourcePod":{"$ref":"#/$defs/SourcePod","description":"SourcePod specifies which pod to execute curl/wget commands from The pod must have curl or wget installed Security note: ensure source pods are trusted as they execute HTTP requests"},"targets":{"type":"array","items":{"$ref":"#/$defs/ConnectivityCheck"},"description":"Targets lists all connectivity checks to perform from the source pod"}},"description":"ConnectivitySpec tests HTTP connectivity between pods in the cluster Use when: verifying Services work, NetworkPolicies allow traffic, or inter-pod communication","required":["sourcePod","targets"],"additionalProperties":false},"SourcePod":{"type":"object","properties":{"name":{"type":"string","description":"Name matches a specific pod by exact name (mutually exclusive with LabelSelector)"},"labelSelector":{"type":"object","additionalProperties":{"type":"string"},"description":"LabelSelector matches pods by labels, uses first matching pod Example: {\"app\": \"curl-client\"} or {\"role\": \"tester\"}"}},"description":"SourcePod identifies the pod from which connectivity checks are executed Use either Name or LabelSelector to identify the pod","additionalProperties":false},"ConnectivityCheck":{"type":"object","properties":{"url":{"type":"string","description":"URL is the HTTP endpoint to test from the source pod Format: http://service-name:port/path or http://pod-ip:port/path Examples: \"http://nginx-service:80/health\", \"http://api:8080/ready\" For cross-namespace: \"http://service-name.namespace.svc.cluster.local:port\""},"expectedStatusCode":{"type":"integer","description":"ExpectedStatusCode is the HTTP status code that indicates success Common values: 200 (OK), 201 (Created), 204 (No Content), 301/302 (Redirects) Use 0 to verify connection failed (timeout or refused, useful for NetworkPolicy tests)"},"timeoutSeconds":{"type":"integer","description":"TimeoutSeconds is the maximum time to wait for a response (optional) Default is typically 10 seconds, increase for slow services"}},"description":"ConnectivityCheck represents a single HTTP connectivity test Executes an HTTP request from source pod and validates the response code","required":["url","expectedStatusCode"],"additionalProperties":false}}}